<div id="required_fields_message">{$lang['common_fields_required_message']}</div>
<ul class="error_message_box" id="general_error_message_box"></ul>
	
<form class="form-horizontal" id="comany_logo_form" action="home.php?act=config&f=upload" enctype="multipart/form-data" method="post" accept-charset="utf-8">
	<div class="form-group form-group-sm">	
		<label class="control-label col-xs-2 required" for="company_logo">{$lang['config_company_logo']}</label>				<div class="col-xs-6">
			<div class="fileinput {if ($config['company_logo'] == '')}fileinput-new{else} fileinput-exists{/if}" data-provides="fileinput">
				<div class="fileinput-new thumbnail" style="width: 200px; height: 200px;"></div>
				<div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 200px; max-height: 200px;">
					<img class="img-responsive" alt="{$lang['config_company_logo']}" src="{if $config['company_logo'] != ''}{$config['company_logo']}{/if}">
				</div>
				<div>
					<span class="btn btn-default btn-sm btn-file">
						<span class="fileinput-new">{$lang['config_company_select_image']}</span>
						<span class="fileinput-exists">{$lang['config_company_change_image']}</span>
						<input id="company_logo" name="company_logo" type="file" accept="image/*">
					</span>
					<a class="btn btn-default btn-sm fileinput-exists {if ($config['company_logo'] == '')}src-only{/if}" data-dismiss="fileinput">{$lang['config_company_remove_image']}</a>
					<input class="btn btn-primary btn-sm" type="submit" value="{$lang['common_upload']}">
				</div>
			</div>
		</div>
	</div>
</form>
				
<form class="form-horizontal" id="general_form" action="home.php?act=config&f=general" enctype="multipart/form-data" method="post" accept-charset="utf-8">	
	<fieldset>
		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2 required" for="company">{$lang['config_company']}</label>				<div class="col-xs-6">
				<input name="company" class="form-control input-sm" id="company" type="text" value="{$config['company']}">
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2 required" for="company_start">{$lang['config_company_start']}</label>
			<div class="col-xs-6">
				<div class="input-group">
					<input name="company_start" class="form-control input-sm" id="company_start" type="text" value="{$config['company_start']}">
					<span class="input-group-addon input-sm">{$lang['config_company_start_format']}</span>
				</div>
			</div>
		</div>
		
		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2 required" for="address">{$lang['config_address']}</label>				<div class="col-xs-6">
				<textarea name="address" class="form-control input-sm" id="address" rows="3" cols="40">{$config['address']}</textarea>
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2" for="website">{$lang['config_website']}</label>				<div class="col-xs-6">
				<input name="website" class="form-control input-sm" id="website" type="text" value="{$config['website']}">
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2" for="email">{$lang['common_email']}</label>				<div class="col-xs-6">
				<input name="email" class="form-control input-sm" id="email" type="email" value="{$config['email']}">
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2 required" for="phone">{$lang['config_phone']}</label>				<div class="col-xs-6">
				<input name="phone" class="form-control input-sm" id="phone" type="text" value="{$config['phone']}">
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2" for="fax">{$lang['config_fax']}</label>				<div class="col-xs-6">
				<input name="fax" class="form-control input-sm" id="fax" type="text" value="{$config['fax']}">
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2 required" for="return_policy">{$lang['common_return_policy']}</label>				<div class="col-xs-6">
				<textarea name="return_policy" class="form-control input-sm" id="return_policy" rows="3" cols="40">{$config['return_policy']}</textarea>
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2 required" for="default_tax_1_rate">{$lang['config_default_tax_rate_1']}</label>				<div class="col-xs-2">
				<input name="default_tax_1_name" class="form-control input-sm" id="default_tax_1_name" type="text" value="{if isset($config['default_tax_1_name'])}{$config['default_tax_1_name']}{else}{$lang['items_sales_tax_1']}{/if}">
			</div>
			<div class="col-xs-1 input-group">
				<input name="default_tax_1_rate" class="form-control input-sm" id="default_tax_1_rate" type="text" value="{if isset($config['default_tax_1_rate'])}{$config['default_tax_1_rate']}{/if}">
				<span class="input-group-addon input-sm">%</span>
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2" for="default_tax_2_rate">{$lang['config_default_tax_rate_2']}</label>				<div class="col-xs-2">
				<input name="default_tax_2_name" class="form-control input-sm" id="default_tax_2_name" type="text" value="{if isset($config['default_tax_2_name'])}{$config['default_tax_2_name']}{else}{$lang['items_sales_tax_2']}{/if}">
			</div>
			<div class="col-xs-1 input-group">
				<input name="default_tax_2_rate" class="form-control input-sm" id="default_tax_2_rate" type="text" value="{if isset($config['default_tax_2_rate'])}{$config['default_tax_2_rate']}{/if}">
				<span class="input-group-addon input-sm">%</span>
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2" for="tax_included">{$lang['config_tax_included']}</label>				<div class="col-xs-1">
				<input name="tax_included" class="form-control input-sm" value="1" id="tax_included" type="checkbox" {if ($config['tax_included'] == 1)}checked="checked"{/if}>
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2 required" for="default_sales_discount">{$lang['config_default_sales_discount']}</label>				<div class="col-xs-2">
				<div class="input-group">
					<input name="default_sales_discount" class="form-control input-sm" id="default_sales_discount" type="number" min="0" max="100" value="{$config['default_sales_discount']}">
					<span class="input-group-addon input-sm">%</span>
				</div>
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2" for="receiving_calculate_average_price">{$lang['config_receiving_calculate_average_price']}</label>				<div class="col-xs-1">
				<input name="receiving_calculate_average_price" class="form-control input-sm" value="1" id="receiving_calculate_average_price" type="checkbox" {if $config['receiving_calculate_average_price'] == 1}checked="checked"{/if}>
			</div>
		</div>

		<div class="form-group form-group-sm">	
			<label class="control-label col-xs-2" for="backup_db">{$lang['config_backup_database']}</label>				<div class="col-xs-2">
				<div class="btn btn-default btn-sm" id="backup_db">
					<span style="top:22%;">{$lang['config_backup_button']}</span>
				</div>
			</div>
		</div>

		<input class="btn btn-primary btn-sm pull-right" type="submit" value="{$lang['common_submit']}">
	</fieldset>
</form>
<script type="text/javascript">
//validation and submit handling
$(document).ready(function()
{
	$("#backup_db").click(function() {
		$.ajax({
			type: "POST",
			url: "home.php",
			data: "act=config&f=backup_db",
			success: function(response) {
				if(response.success) {
					set_feedback(response.msg, 'alert alert-dismissible alert-success', false);		
				} else {
					set_feedback(response.msg, 'alert alert-dismissible alert-danger', false);		
				}
			},
			dataType: "json"
		})
	});

	$("a.fileinput-exists").click(function() {
		$.ajax({
			type: "GET",
			url: "home.php",
			data: "act=config&f=remove_logo",
			dataType: "json"
		})
	});

	$('#comany_logo_form').validate({
		submitHandler: function(form) {
			$(form).ajaxSubmit({
				success: function(response)	{
					if(response.success)
					{
						set_feedback(response.msg, 'alert alert-dismissible alert-success', false);		
					}
					else
					{
						set_feedback(response.msg, 'alert alert-dismissible alert-danger', false);		
					}
				},
				dataType: 'json'
			});
		},
				
		errorClass: "has-error",
		errorLabelContainer: "#general_error_message_box",
		wrapper: "li",
		highlight: function (e)	{
			$(e).closest('.form-group').addClass('has-error');
		},
		unhighlight: function (e) {
			$(e).closest('.form-group').removeClass('has-error');
		},
		
		rules: 
		{
			company_logo: { required: true }
		},
		
		messages:
		{
			company_logo: { required: "{$lang["config_company_logo_required"]}" }
		}
	});
	
	$('#general_form').validate({
		submitHandler: function(form) {
			$(form).ajaxSubmit({
				success: function(response)	{
					if(response.success)
					{
						set_feedback(response.msg, 'alert alert-dismissible alert-success', false);		
					}
					else
					{
						set_feedback(response.msg, 'alert alert-dismissible alert-danger', false);		
					}
				},
				dataType: 'json'
			});
		},

		errorClass: "has-error",
		errorLabelContainer: "#general_error_message_box",
		wrapper: "li",
		highlight: function (e)	{
			$(e).closest('.form-group').addClass('has-error');
		},
		unhighlight: function (e) {
			$(e).closest('.form-group').removeClass('has-error');
		},

		rules: 
		{
			company: { required: true },
			company_start: { 
				required: true,
			},
			address: { required: true },
			phone: { required: true },
    		default_tax_1_rate:
    		{
    			required: true,
    			number: true
    		},
			default_tax_1_name: { required: true },
    		email: { email: true },
    		return_policy: { required: true },
    		default_sales_discount: 
        	{
        		required: true,
        		number: true
    		}  		
   		},

		messages: 
		{
			company: { required: "{$lang["config_company_required"]}" },
			company_start: { required: "{$lang["config_company_start_required"]}" },
			address: { required: "{$lang["config_address_required"]}" },
			phone: { required: "{$lang["config_phone_required"]}" },
			default_tax_1_rate:
			{
				required: "{$lang["config_default_tax_rate_required"]}",
				number: "{$lang["config_default_tax_rate_number"]}"
			},
			default_tax_1_name:
			{
				required: "{$lang["config_default_tax_name_required"]}",
				number: "{$lang["config_default_tax_rate_number"]}"
			},
			email: { email: "{$lang["common_email_invalid_format"]}" },
			return_policy: "{$lang["config_return_policy_required"]}",
			default_sales_discount:
			{
				required: "{$lang["config_default_sales_discount_required"]}",
				number: "{$lang["config_default_sales_discount_number"]}"
			}
		}
	});
});
</script>
    